import{s as b,t as _,W as y,p as w,_ as g}from"./calendar.b79dcdef.js";import{_ as k,r as z,o as s,c as l,a as t,w as c,v as p,p as u,t as d,h as r,e as x,b as V,F as T,d as B,q as C,n as A}from"./vendor.f746383d.js";import{_ as v}from"./index.f47014ba.js";const D={name:"CreateAnnouncement",components:{Datepicker:b},data(){return{slug:this.$route.params.slug,timezoneList:_,date:"",announce:{},townhall:{},validation:{invalid:{},valid:{}}}},computed:{},created(){this.getTownhallData()},mounted(){},methods:{backToAnnounce(){this.$router.push(`/${this.slug}/announcement`)},validateAnnouncement(){if(this.announce.title)this.validation.valid.title="The tile of proposal is OK.";else{this.validation.invalid.title="Please type your title of proposal.";return}if(this.announce.summary)this.validation.valid.summary="The tile of summary is OK.";else{this.validation.invalid.summary="Please type your summary of proposal.";return}if(this.announce.date)this.validation.valid.date="The date is OK.";else{this.validation.invalid.date="Please type your expire date of proposal.",console.log(this.validation.invalid.date);return}if(this.announce.timezone)this.validation.valid.timezone="The timezone is selected.";else{this.validation.invalid.timezone="Please select your timezone.",console.log(this.validation.invalid.timezone);return}this.createBroadcast()},getTownhallData(){api.getTownhallData({slug:this.slug},a=>{a.data.townhall&&(this.townhall=a.data.townhall)},a=>{console.log(a)})},async createBroadcast(){if(this.townhall.details.webThrKey){var a=new y({token:this.townhall.details.webThrKey});const i=new Blob([JSON.stringify(this.announce)],{type:"application/json"}),f=[new File([i],"superwarden.json")],m=await a.put(f,{maxRetries:3});if(m){if(this.$toast.success("succeeded to ipfs upload"),this.townhall.details.pinataKey!=""&&this.townhall.details.pinataSecret!=""){const e=w(this.townhall.details.pinataKey,this.townhall.details.pinataSecret),o={pinataMetadata:{name:"superwarden"}};e.pinByHash(m,o).then(h=>{this.$toast.success("succeeded to pinata upload")}).catch(h=>{this.$toast.error("failed to pinata upload")})}else this.$toast.error("please reset your pinata settings");api.createBroadcast({slug:this.slug,announce:this.announce,creator:this.$store.getters._id,cid:m},e=>{console.log(e.data),e.data.announce.title?(this.$toast.success("succeeded to broadcast an announcement."),this.$router.push(`/${this.slug}/announcement`)):this.$toast.error("fail to connect to the server.")},e=>{console.log(e)})}else this.$toast.error(`fail to ipfs upload
 please check your web3.storage api key`)}else this.$toast.error(`fail to ipfs upload
 please set your web3.storage api key to your townhall.`)},clearValidation:function(a){this.validation.valid[a]="",this.validation.invalid[a]=""}}},S={style:{"padding-left":"35px","margin-left":"100px"}},F=t("b",null,"\u2190 Back",-1),K=[F],P=t("p",{class:"mt-5 fw-bolder fs-1 text-dark"},"Broadcast announcement",-1),j={class:"col-md-7"},U=t("div",{class:"lisi-item mb-3"},[t("img",{src:v}),t("span",{class:"fw-bolder"},"The broadcasted announcement will be store on Web3.storage")],-1),M=t("div",{class:"lisi-item mb-3"},[t("img",{src:v}),t("span",{class:"fw-bolder"},"Pinata will perform additional pinning")],-1),I=t("div",{class:"lisi-item mb-3"},[t("img",{src:v}),t("span",{class:"fw-bolder"}," You can delete the announcement after it was broadcasted. However, it will just be invisibile in the announcement list. For actual deletion, you need to delete it from Web3.storage and also unpin the CID at Pinata. ")],-1),N=t("div",{class:"lisi-item mb-5"},[t("img",{src:v}),t("span",{class:"fw-bolder"},"Please note that if there are nodes on IPFS network still saving a copy of your announcement, you can\u2019t really permenantly delete it.")],-1),O={class:"mb-4 mt-2"},W=t("label",{for:"title",class:"form-label fw-bolder fs-6"},"Title of announcement",-1),L={key:0,class:"valid-feedback"},E={key:1,class:"invalid-feedback"},H={class:"mb-4 mt-2"},q=t("label",{for:"summary",class:"form-label fw-bolder fs-6"},"Summary",-1),J={key:0,class:"valid-feedback"},R={key:1,class:"invalid-feedback"},Y={class:"mb-4 mt-2"},G=t("label",{for:"attachment_link",class:"form-label fw-bolder fs-6"},"Attachment link",-1),Q={class:"mb-4 mt-2"},X=t("label",{for:"attachment_link",class:"form-label fw-bolder fs-6"},"Valid till?",-1),Z={style:{width:"92.5%"}},$=t("span",{class:"input-group-text"},[t("img",{src:g,style:{height:"22px"}})],-1),ee={key:0,class:"invalid-feedback",style:{display:"flex"}},te={class:"mb-4 mt-2"},ie=t("label",{for:"time-zone",class:"form-label fw-bolder fs-6"},"Timezone",-1),ne=t("option",{value:"",selected:"",disabled:""},"Choose your timezone",-1),ae=["value","label"],oe={key:0,class:"valid-feedback"},se={key:1,class:"invalid-feedback"},le=t("p",{class:"fw-bolder fs-6 mb-1"},"Important announcement",-1),de=t("span",{class:"",style:{"font-weight":"700","font-size":"14px",color:"#959595"}},"If check, the announcement will be marked with a red star",-1),re={class:"form-check form-switch mt-2"},ce=t("button",{type:"submit",class:"btn btn-danger float-end mt-4"},"Broadcast",-1);function me(a,i,f,m,e,o){const h=z("Datepicker");return s(),l("div",S,[t("button",{type:" ",class:"btn btn-default mt-3 p-0",onClick:i[0]||(i[0]=(...n)=>o.backToAnnounce&&o.backToAnnounce(...n))},K),P,t("form",{onSubmit:i[11]||(i[11]=A((...n)=>o.validateAnnouncement&&o.validateAnnouncement(...n),["prevent"])),class:"row mt-4 mb-5",style:{width:"100%"}},[t("div",j,[U,M,I,N,t("div",O,[W,c(t("input",{"onUpdate:modelValue":i[1]||(i[1]=n=>e.announce.title=n),class:u([{"is-valid":e.validation.valid.title,"is-invalid":e.validation.invalid.title},"form-control"]),onFocus:i[2]||(i[2]=n=>o.clearValidation("title")),type:"text",id:"title",autocomplete:"false"},null,34),[[p,e.announce.title]]),e.validation.valid.title?(s(),l("div",L,d(e.validation.valid.title),1)):r("",!0),e.validation.invalid.title?(s(),l("div",E,d(e.validation.invalid.title),1)):r("",!0)]),t("div",H,[q,c(t("textarea",{"onUpdate:modelValue":i[3]||(i[3]=n=>e.announce.summary=n),class:u([{"is-valid":e.validation.valid.summary,"is-invalid":e.validation.invalid.summary},"form-control"]),onFocus:i[4]||(i[4]=n=>o.clearValidation("summary")),rows:"10",autocomplete:"false"},null,34),[[p,e.announce.summary]]),e.validation.valid.summary?(s(),l("div",J,d(e.validation.valid.summary),1)):r("",!0),e.validation.invalid.summary?(s(),l("div",R,d(e.validation.invalid.summary),1)):r("",!0)]),t("div",Y,[G,c(t("input",{"onUpdate:modelValue":i[5]||(i[5]=n=>e.announce.attachment=n),type:"text",class:"form-control",placeholder:"Eg. blog post"},null,512),[[p,e.announce.attachment]])]),t("div",Q,[X,t("div",{class:u(["input-group",{"is-valid":e.validation.valid.date,"superwarden-invalid":e.validation.invalid.date}])},[t("div",Z,[x(h,{modelValue:e.announce.date,"onUpdate:modelValue":i[6]||(i[6]=n=>e.announce.date=n),onFocus:i[7]||(i[7]=n=>o.clearValidation("date")),class:"form-control border-end-0 superwarden-right-border",placeholder:"choose a date",style:{width:"100%"}},null,8,["modelValue"])]),$],2),e.validation.invalid.date?(s(),l("div",ee,d(e.validation.invalid.date),1)):r("",!0)]),t("div",te,[ie,c(t("select",{"onUpdate:modelValue":i[8]||(i[8]=n=>e.announce.timezone=n),class:u([{"is-valid":e.validation.valid.timezone,"is-invalid":e.validation.invalid.timezone},"form-select"]),onFocus:i[9]||(i[9]=n=>o.clearValidation("timezone"))},[ne,(s(!0),l(T,null,B(e.timezoneList,n=>(s(),l("option",{value:n,label:n.label},null,8,ae))),256))],34),[[V,e.announce.timezone]]),e.validation.valid.timezone?(s(),l("div",oe,d(e.validation.valid.timezone),1)):r("",!0),e.validation.invalid.timezone?(s(),l("div",se,d(e.validation.invalid.timezone),1)):r("",!0)]),le,de,t("div",re,[c(t("input",{"onUpdate:modelValue":i[10]||(i[10]=n=>e.announce.importance=n),style:{height:"32px",width:"65px"},class:"form-check-input",type:"checkbox"},null,512),[[C,e.announce.importance]])]),ce])],32)])}var pe=k(D,[["render",me]]);export{pe as default};
